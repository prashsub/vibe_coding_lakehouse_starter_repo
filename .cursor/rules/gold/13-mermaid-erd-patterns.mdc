---
description: Patterns for creating clean, professional Mermaid ERD diagrams for data modeling documentation
globs: ["docs/**/*.md", "**/*ERD*.md"]
alwaysApply: false
---

# Mermaid ERD Diagram Patterns

## Pattern Recognition

Mermaid ERD diagrams are used throughout the project to document data models, especially in the Gold layer. This rule standardizes the syntax and formatting for maintainability and clarity.

---

## ERD Organization Strategy: Master vs Domain ERDs

### When to Use Each Approach

| Tables | Approach | Rationale |
|--------|----------|-----------|
| **1-8 tables** | Master ERD only | Simple enough to visualize in one diagram |
| **9-20 tables** | Master ERD + Domain ERDs | Too complex for single diagram, needs breakdown |
| **20+ tables** | Domain ERDs + Summary ERD | Master becomes unreadable, focus on domains |

### ERD Hierarchy

```
gold_layer_design/
â”œâ”€â”€ erd_master.md              # Complete model (all tables)
â”œâ”€â”€ erd_summary.md             # High-level domain relationships (optional, 20+ tables)
â””â”€â”€ erd/                       # Domain-specific ERDs
    â”œâ”€â”€ erd_location.md        # Store, region, territory dimensions
    â”œâ”€â”€ erd_product.md         # Product, brand, category dimensions
    â”œâ”€â”€ erd_time.md            # Date, fiscal period dimensions
    â”œâ”€â”€ erd_sales.md           # Sales facts and related dimensions
    â”œâ”€â”€ erd_inventory.md       # Inventory facts and snapshots
    â””â”€â”€ erd_customer.md        # Customer dimension and loyalty facts
```

### Domain ERD Benefits

1. **Manageability** - Each domain fits on one screen
2. **Focus** - Stakeholders see only relevant tables
3. **Parallel Development** - Teams can work on domains independently
4. **Change Impact** - Clear scope for schema changes
5. **Documentation** - Domain-specific business context

---

## Master ERD Pattern

### Purpose
Shows the **complete data model** with all tables and relationships. Used for:
- Executive overview
- Data architect reference
- Completeness validation
- Cross-domain relationship visibility

### Master ERD Template

```markdown
# Gold Layer Master ERD

## Overview
Complete dimensional model showing all [N] tables across [M] domains.

**Domains:**
- ğŸª Location: dim_store, dim_region, dim_territory
- ğŸ“¦ Product: dim_product, dim_brand, dim_category
- ğŸ“… Time: dim_date, dim_fiscal_period
- ğŸ’° Sales: fact_sales_daily, fact_sales_hourly
- ğŸ“Š Inventory: fact_inventory_snapshot, fact_replenishment

## Complete Entity Relationship Diagram

```mermaid
erDiagram
  %% â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  %% ğŸª LOCATION DOMAIN
  %% â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  dim_store {
    string store_key PK
    string store_number
    string store_name
    string region_key
    boolean is_current
  }
  
  dim_region {
    string region_key PK
    string region_name
    string territory_key
  }
  
  %% â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  %% ğŸ“¦ PRODUCT DOMAIN
  %% â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  dim_product {
    string product_key PK
    string upc_code
    string product_name
    string brand_key
    string category_key
  }
  
  dim_brand {
    string brand_key PK
    string brand_name
    string manufacturer
  }
  
  %% â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  %% ğŸ“… TIME DOMAIN
  %% â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  dim_date {
    int date_key PK
    date date_value
    int year
    int quarter
    int month
  }
  
  %% â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  %% ğŸ’° SALES DOMAIN (Facts)
  %% â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  fact_sales_daily {
    string store_number PK
    string upc_code PK
    date transaction_date PK
    double net_revenue
    int units_sold
  }
  
  %% â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  %% ğŸ“Š INVENTORY DOMAIN (Facts)
  %% â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  fact_inventory_snapshot {
    string store_number PK
    string upc_code PK
    date snapshot_date PK
    int on_hand_qty
    int min_stock_qty
  }
  
  %% â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  %% RELATIONSHIPS
  %% â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  %% Location hierarchy
  dim_region ||--o{ dim_store : by_region_key
  
  %% Product hierarchy
  dim_brand ||--o{ dim_product : by_brand_key
  
  %% Sales relationships
  dim_store   ||--o{ fact_sales_daily : by_store_number
  dim_product ||--o{ fact_sales_daily : by_upc_code
  dim_date    ||--o{ fact_sales_daily : by_transaction_date
  
  %% Inventory relationships
  dim_store   ||--o{ fact_inventory_snapshot : by_store_number
  dim_product ||--o{ fact_inventory_snapshot : by_upc_code
  dim_date    ||--o{ fact_inventory_snapshot : by_snapshot_date
```

## Domain Index

| Domain | Tables | Primary Fact | Detail ERD |
|--------|--------|--------------|------------|
| ğŸª Location | dim_store, dim_region, dim_territory | N/A | [erd_location.md](erd/erd_location.md) |
| ğŸ“¦ Product | dim_product, dim_brand, dim_category | N/A | [erd_product.md](erd/erd_product.md) |
| ğŸ“… Time | dim_date, dim_fiscal_period | N/A | [erd_time.md](erd/erd_time.md) |
| ğŸ’° Sales | fact_sales_daily, fact_sales_hourly | fact_sales_daily | [erd_sales.md](erd/erd_sales.md) |
| ğŸ“Š Inventory | fact_inventory_snapshot | fact_inventory_snapshot | [erd_inventory.md](erd/erd_inventory.md) |

## Cross-Domain Relationships

| From Domain | To Domain | Relationship | Purpose |
|-------------|-----------|--------------|---------|
| Location â†’ Sales | dim_store â†’ fact_sales | by_store_number | Geographic sales analysis |
| Product â†’ Sales | dim_product â†’ fact_sales | by_upc_code | Product performance |
| Time â†’ Sales | dim_date â†’ fact_sales | by_transaction_date | Temporal trends |
| Location â†’ Inventory | dim_store â†’ fact_inventory | by_store_number | Store stock levels |
```

---

## Domain ERD Pattern

### Purpose
Shows **focused view** of tables within a single business domain. Used for:
- Domain-specific stakeholder discussions
- Development team reference
- Detailed column documentation
- Domain change management

### Domain ERD Template

```markdown
# [Domain Name] Domain ERD

## Domain Overview
[2-3 sentences describing the domain's business purpose]

**Tables in this domain:** [N]
**Related domains:** [List domains with cross-domain relationships]

## Entity Relationship Diagram

```mermaid
erDiagram
  %% â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  %% [DOMAIN NAME] - Dimensions
  %% â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  dim_primary {
    string key PK
    string business_key
    string attribute_1
    string attribute_2
    boolean is_current
  }
  
  dim_secondary {
    string key PK
    string business_key
    string parent_key
  }
  
  %% â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  %% [DOMAIN NAME] - Facts (if applicable)
  %% â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  fact_domain_metric {
    string dim_key PK
    date date_key PK
    double measure_1
    int measure_2
  }
  
  %% â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  %% CROSS-DOMAIN REFERENCES (External)
  %% â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  %% These tables are defined in other domains
  %% Shown here for relationship context
  dim_external_1["dim_external_1 (Time Domain)"] {
    int date_key PK
  }
  
  %% â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  %% RELATIONSHIPS
  %% â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  %% Internal domain relationships
  dim_secondary ||--o{ dim_primary : by_parent_key
  
  %% Cross-domain relationships (to external tables)
  dim_primary ||--o{ fact_domain_metric : by_dim_key
  dim_external_1 ||--o{ fact_domain_metric : by_date_key
```

## Table Details

### dim_primary
| Column | Type | Description |
|--------|------|-------------|
| key | STRING | Surrogate key |
| business_key | STRING | Natural business identifier |
| ... | ... | ... |

### dim_secondary
[Similar table documentation]

## Cross-Domain Dependencies

| External Table | Domain | Relationship | Purpose |
|----------------|--------|--------------|---------|
| dim_date | Time | fact â†’ dim_date | Temporal analysis |
| dim_store | Location | fact â†’ dim_store | Geographic drill-down |

## Related Documentation
- [Master ERD](../erd_master.md) - Complete model
- [Time Domain ERD](erd_time.md) - Date dimension details
- [YAML Schema](../yaml/domain/dim_primary.yaml) - Implementation schema
```

---

## Standard Domain Categories

Use these standard domains for organizing tables:

| Domain | Emoji | Typical Tables | Description |
|--------|-------|----------------|-------------|
| **Location** | ğŸª | dim_store, dim_region, dim_territory, dim_country | Geographic hierarchy |
| **Product** | ğŸ“¦ | dim_product, dim_brand, dim_category, dim_supplier | Product hierarchy |
| **Time** | ğŸ“… | dim_date, dim_time, dim_fiscal_period | Temporal dimensions |
| **Customer** | ğŸ‘¤ | dim_customer, dim_segment, dim_loyalty_tier | Customer attributes |
| **Sales** | ğŸ’° | fact_sales_*, dim_promotion, dim_channel | Revenue & transactions |
| **Inventory** | ğŸ“Š | fact_inventory_*, dim_warehouse | Stock & replenishment |
| **Finance** | ğŸ’µ | fact_gl_*, dim_account, dim_cost_center | Financial measures |
| **Operations** | âš™ï¸ | fact_shipment_*, dim_carrier, dim_route | Operational metrics |
| **HR** | ğŸ‘¥ | dim_employee, dim_department, dim_job | Human resources |
| **Marketing** | ğŸ“£ | fact_campaign_*, dim_campaign, dim_audience | Marketing analytics |

### Domain Assignment Rules

1. **Dimensions** â†’ Assign to domain based on primary business concept
2. **Facts** â†’ Assign to domain of the primary measure (sales fact â†’ Sales domain)
3. **Bridge tables** â†’ Assign to domain of the "many" side
4. **Conformed dimensions** (date, geography) â†’ Own domain, referenced by others

---

## Cross-Domain Relationship Patterns

### Pattern 1: External Table Reference (Visual Indicator)

Use bracketed syntax with domain annotation for tables from other domains:

```mermaid
erDiagram
  %% This domain's tables
  fact_sales {
    string store_number PK
    date transaction_date PK
  }
  
  %% External references (from other domains)
  dim_store["dim_store (Location)"] {
    string store_number PK
  }
  
  dim_date["dim_date (Time)"] {
    date date_value PK
  }
  
  %% Relationships
  dim_store ||--o{ fact_sales : by_store_number
  dim_date ||--o{ fact_sales : by_date
```

### Pattern 2: Minimal External Reference

For simpler diagrams, show only the key columns of external tables:

```mermaid
erDiagram
  %% Domain focus
  fact_sales {
    string store_number PK
    date transaction_date PK
    double net_revenue
    int units_sold
  }
  
  %% External tables - keys only
  dim_store["ğŸª dim_store"] { string store_number PK }
  dim_date["ğŸ“… dim_date"] { date date_value PK }
  
  %% Relationships
  dim_store ||--o{ fact_sales : by_store_number
  dim_date ||--o{ fact_sales : by_date
```

### Pattern 3: Summary ERD (High-Level Domain View)

For very large models (20+ tables), create a summary showing domains as entities:

```mermaid
erDiagram
  LOCATION_DOMAIN["ğŸª Location (3 tables)"] {
    string dim_store
    string dim_region
    string dim_territory
  }
  
  PRODUCT_DOMAIN["ğŸ“¦ Product (4 tables)"] {
    string dim_product
    string dim_brand
    string dim_category
    string dim_supplier
  }
  
  TIME_DOMAIN["ğŸ“… Time (2 tables)"] {
    string dim_date
    string dim_fiscal_period
  }
  
  SALES_DOMAIN["ğŸ’° Sales (2 facts)"] {
    string fact_sales_daily
    string fact_sales_hourly
  }
  
  %% Domain relationships
  LOCATION_DOMAIN ||--o{ SALES_DOMAIN : "store analysis"
  PRODUCT_DOMAIN ||--o{ SALES_DOMAIN : "product performance"
  TIME_DOMAIN ||--o{ SALES_DOMAIN : "temporal trends"
```

---

## Core Principles

### 1. Clean and Concise Syntax

âŒ **DON'T: Add inline comments to every column**
```mermaid
erDiagram
  dim_store {
    string store_key PK "Surrogate key (SCD2 version)"
    string store_number BK "Business key (natural key)"
    string store_name "Store name"
  }
```

âœ… **DO: Use simple PK markers, describe in documentation**
```mermaid
erDiagram
  dim_store {
    string store_key PK
    string store_number
    string store_name
  }
```

**Rationale:** 
- Inline comments clutter the diagram
- Column descriptions belong in table documentation, not ERD
- PK/FK markers provide sufficient metadata for relationships

### 2. Consistent Formatting

âœ… **Use 2-space indentation consistently:**
```mermaid
erDiagram
  %% =========================
  %% Dimensions
  %% =========================
  dim_store {
    string store_key PK
    string store_number
  }
  
  %% =========================
  %% Facts
  %% =========================
  fact_sales {
    string store_number PK
    date transaction_date PK
  }
```

### 3. Section Organization

âœ… **Organize with clear visual separators:**
```mermaid
erDiagram
  %% =========================
  %% Dimensions
  %% =========================
  dim_table_1 { ... }
  dim_table_2 { ... }
  
  %% =========================
  %% Facts
  %% =========================
  fact_table_1 { ... }
  fact_table_2 { ... }
  
  %% =========================
  %% Relationships (cardinalities)
  %% =========================
  dim_table_1 ||--o{ fact_table_1 : by_key
```

### 4. Relationship Labeling

âŒ **DON'T: Use long, verbose relationship labels**
```mermaid
dim_store ||--o{ fact_sales_daily : "store_number (business key)"
```

âœ… **DO: Use short, technical labels**
```mermaid
dim_store ||--o{ fact_sales_daily : by_store_number
```

**Pattern:** `by_{column_name}` for join columns

### 5. Avoid Reserved Keywords

âŒ **DON'T: Use SQL reserved keywords as column names**
```mermaid
dim_date {
  int date_key PK
  date date        -- 'date' is a reserved keyword
}
```

âœ… **DO: Use descriptive alternative names**
```mermaid
dim_date {
  int date_key PK
  date date_value  -- Clear and unambiguous
}
```

## Complete Example Pattern

### Gold Layer Star Schema

```mermaid
erDiagram
  %% =========================
  %% Dimensions
  %% =========================
  dim_store {
    string store_key PK
    string store_number
    string store_name
    string city
    string state
    boolean is_current
    timestamp effective_from
    timestamp effective_to
  }

  dim_product {
    string product_key PK
    string upc_code
    string sku_description
    string brand
    string manufacturer
  }

  dim_date {
    int date_key PK
    date date_value
    int year
    int month
    int quarter
    boolean is_weekend
  }

  %% =========================
  %% Facts
  %% =========================
  fact_sales_daily {
    string store_number PK
    string upc_code PK
    date transaction_date PK
    double net_revenue
    int units_sold
    int transaction_count
  }

  fact_inventory_snapshot {
    string store_number PK
    string upc_code PK
    int current_on_hand
    int current_minimum
    boolean needs_replenishment
  }

  %% =========================
  %% Relationships (cardinalities)
  %% =========================
  dim_store   ||--o{ fact_sales_daily : by_store_number
  dim_product ||--o{ fact_sales_daily : by_upc_code
  dim_date    ||--o{ fact_sales_daily : by_transaction_date
  
  dim_store   ||--o{ fact_inventory_snapshot : by_store_number
  dim_product ||--o{ fact_inventory_snapshot : by_upc_code
```

## Primary Key Markers

Use these standard markers:

| Marker | Meaning | Usage |
|--------|---------|-------|
| `PK` | Primary Key | Unique identifier for the table |
| *(none)* | Regular column | No special marker needed |

**Note:** Don't use `FK`, `BK`, `UK` markers in the ERD diagram itself. These are documented in the implementation plan tables.

## Relationship Cardinality Notation

| Notation | Meaning | Description |
|----------|---------|-------------|
| `\|\|--o{` | One-to-Many | One dimension record to many fact records |
| `\|\|--\|\|` | One-to-One | Rare in dimensional modeling |
| `}o--o{` | Many-to-Many | Requires bridge table |

**Most Common:** `||--o{` for dimension-to-fact relationships (star schema)

## Data Type Conventions

Use Databricks SQL type names:

| Type | Usage | Example Column |
|------|-------|---------------|
| `string` | Text, IDs | store_number, city, state |
| `int` | Integers | year, month, quarter |
| `bigint` | Large integers | units_sold, transaction_count |
| `double` | Decimals | price, revenue, percentage |
| `decimal` | Fixed precision | *(rarely used, prefer double)* |
| `date` | Date only | transaction_date, open_date |
| `timestamp` | Date + time | record_created_timestamp |
| `boolean` | True/False | is_current, is_weekend |

## Composite Primary Keys

For fact tables with grain at multiple dimensions:

```mermaid
fact_sales_daily {
  string store_number PK
  string upc_code PK
  date transaction_date PK
  double net_revenue
  int units_sold
}
```

**Pattern:** Mark each column in the composite key with `PK`

## SCD Type 2 Pattern

For slowly changing dimensions:

```mermaid
dim_store {
  string store_key PK           -- Surrogate, unique per version
  string store_number           -- Business key (repeats)
  timestamp effective_from
  timestamp effective_to
  boolean is_current
}
```

**Key Point:** `store_key` is PK, but FKs reference `store_number`

## Validation Checklist

### General ERD Standards
- [ ] Use 2-space indentation consistently
- [ ] Add section headers with visual separators
- [ ] Use only `PK` markers (no inline descriptions)
- [ ] Avoid reserved keywords (`date` â†’ `date_value`)
- [ ] Use `by_{column}` pattern for relationship labels
- [ ] Group relationships at the end
- [ ] Match actual table/column names from DDL
- [ ] Use correct Databricks SQL type names

### Master vs Domain ERD Organization
- [ ] Table count assessed (1-8: Master only, 9-20: Master + Domain, 20+: Domain + Summary)
- [ ] Master ERD created showing all tables
- [ ] Domain ERDs created for each logical domain (if 9+ tables)
- [ ] Summary ERD created showing domain relationships (if 20+ tables)
- [ ] Cross-domain relationships documented in both Master and Domain ERDs
- [ ] Domain index table included in Master ERD
- [ ] External table references use bracketed notation with domain labels

### File Organization
- [ ] ERDs stored in `gold_layer_design/` directory
- [ ] Master ERD named `erd_master.md`
- [ ] Domain ERDs in `erd/` subdirectory named `erd_{domain}.md`
- [ ] All ERDs link to related ERDs and YAML schemas

## Common Mistakes to Avoid

### âŒ Mistake 1: Over-documentation in ERD
```mermaid
store_key PK "Unique identifier for each version"
```
**Fix:** Use simple `PK` marker, document in separate table

### âŒ Mistake 2: Inconsistent indentation
```mermaid
dim_store {
string store_key PK
    string store_number
  string store_name
}
```
**Fix:** Use consistent 2-space indentation

### âŒ Mistake 3: Missing section headers
```mermaid
erDiagram
  dim_store { ... }
  dim_product { ... }
  fact_sales { ... }
```
**Fix:** Add `%% Dimensions` and `%% Facts` headers

### âŒ Mistake 4: Verbose relationship labels
```mermaid
dim_store ||--o{ fact_sales : "Each store can have many sales transactions"
```
**Fix:** Use concise label: `by_store_number`

## Integration with Documentation

### ERD File Organization

```
gold_layer_design/
â”œâ”€â”€ erd_master.md                 # Complete model (always create)
â”œâ”€â”€ erd_summary.md                # Domain-level view (20+ tables)
â”œâ”€â”€ erd/                          # Domain ERDs (9+ tables)
â”‚   â”œâ”€â”€ erd_location.md
â”‚   â”œâ”€â”€ erd_product.md
â”‚   â”œâ”€â”€ erd_time.md
â”‚   â”œâ”€â”€ erd_sales.md
â”‚   â”œâ”€â”€ erd_inventory.md
â”‚   â””â”€â”€ erd_customer.md
â”œâ”€â”€ yaml/                         # YAML schemas by domain
â”‚   â”œâ”€â”€ location/
â”‚   â”œâ”€â”€ product/
â”‚   â”œâ”€â”€ time/
â”‚   â”œâ”€â”€ sales/
â”‚   â””â”€â”€ inventory/
â”œâ”€â”€ COLUMN_LINEAGE.md             # Bronze â†’ Silver â†’ Gold mapping
â””â”€â”€ DESIGN_SUMMARY.md             # Design decisions
```

### Where ERD Diagrams Go

| ERD Type | Location | Purpose |
|----------|----------|---------|
| **Master ERD** | `gold_layer_design/erd_master.md` | Complete data model reference |
| **Summary ERD** | `gold_layer_design/erd_summary.md` | Domain relationship overview (large models) |
| **Domain ERDs** | `gold_layer_design/erd/erd_{domain}.md` | Focused domain documentation |
| **Planning Docs** | `docs/gold/GOLD_PK_FK_PLAN.md` | Implementation constraints |

### Supporting Documentation

The ERD diagram should be accompanied by:
- **Implementation Plan** - Detailed constraint definitions
- **Legend Table** - Explaining PK, FK, BK, UK markers
- **Cardinality Rules** - Business logic for relationships
- **Grain Documentation** - Fact table grain definition
- **Domain Index** - Table-to-domain mapping (Master ERD)
- **Cross-Domain Dependencies** - External table references (Domain ERDs)

## Example: Complete Documentation Block

```markdown
## Entity Relationship Diagram

### Data Model

```mermaid
erDiagram
  %% ... ERD diagram here ...
```

### Legend

| Symbol | Meaning |
|--------|---------|
| `PK` | Primary Key |
| `\|\|--o{` | One-to-Many relationship |

### Relationships

1. **dim_store â†’ fact_sales_daily**
   - Join: `dim_store.store_number = fact_sales_daily.store_number`
   - Cardinality: One-to-Many
   - Filter: `WHERE dim_store.is_current = true` (SCD Type 2)
```

## References

- [Mermaid ERD Syntax](https://mermaid.js.org/syntax/entityRelationshipDiagram.html)
- [Databricks Data Types](https://docs.databricks.com/sql/language-manual/sql-ref-datatypes.html)
- [Star Schema Design](https://www.kimballgroup.com/data-warehouse-business-intelligence-resources/kimball-techniques/dimensional-modeling-techniques/)

---

**Updated:** December 17, 2025  
**Based on:** Master vs Domain ERD organization patterns for large data models
**Previous:** October 17, 2025 - `docs/gold/GOLD_PK_FK_PLAN.md` ERD improvements

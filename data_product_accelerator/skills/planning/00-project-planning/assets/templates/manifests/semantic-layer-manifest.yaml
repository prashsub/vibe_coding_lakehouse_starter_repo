# =============================================================================
# Semantic Layer Manifest
# =============================================================================
# Generated by: planning/00-project-planning (stage 5)
# Consumed by:  semantic-layer/00-semantic-layer-setup (stage 6)
#
# This manifest defines all Metric Views, TVFs, and Genie Spaces that the
# Semantic Layer orchestrator should create. It is generated from the plan
# addendums (phase1-addendum-1.2-tvfs.md, phase1-addendum-1.3-metric-views.md,
# phase1-addendum-1.6-genie-spaces.md) and the Gold layer YAML schemas.
#
# Usage:
#   1. Fill in the template below during Planning (stage 5)
#   2. Save as: plans/manifests/semantic-layer-manifest.yaml
#   3. The semantic-layer orchestrator reads this at Phase 0
#   4. If this file doesn't exist, the orchestrator falls back to self-discovery
# =============================================================================

version: 1
manifest_type: semantic-layer
generated_from:
  gold_yaml_dir: gold_layer_design/yaml/
  plan_addendums:
    - plans/phase1-addendum-1.2-tvfs.md
    - plans/phase1-addendum-1.3-metric-views.md
    - plans/phase1-addendum-1.6-genie-spaces.md

# -----------------------------------------------------------------------------
# Global settings
# -----------------------------------------------------------------------------
catalog: ${catalog}
gold_schema: ${gold_schema}
semantic_schema: ${semantic_schema}    # Schema for metric views and TVFs

# -----------------------------------------------------------------------------
# Domains â€” one entry per agent domain
# Repeat this block for each domain defined in the project plan
# -----------------------------------------------------------------------------
domains:
  # ---------------------------------------------------------------------------
  # Example domain (replace with your actual domain)
  # ---------------------------------------------------------------------------
  {domain_name}:
    description: "{Brief description of domain focus area}"
    gold_tables:
      - fact_{entity}
      - dim_{entity_1}
      - dim_{entity_2}

    # -------------------------------------------------------------------------
    # Metric Views for this domain
    # Source: phase1-addendum-1.3-metric-views.md
    # -------------------------------------------------------------------------
    metric_views:
      - name: "{domain}_analytics_metrics"
        source_table: "fact_{entity}"
        description: "Core KPI aggregation for {domain} analytics"
        dimensions:
          - name: "{dimension_1}"
            expr: "{dimension_1}"
            description: "{Dimension description}"
          - name: "{dimension_2}"
            expr: "{dimension_2}"
            description: "{Dimension description}"
        measures:
          - name: "total_{metric}"
            expr: "SUM({metric_column})"
            description: "Total {metric} across all records"
          - name: "{metric}_count"
            expr: "COUNT(*)"
            description: "Number of {entity} records"
        business_questions:
          - "What is the total {metric} by {dimension}?"
          - "How does {metric} trend over time?"

    # -------------------------------------------------------------------------
    # Table-Valued Functions for this domain
    # Source: phase1-addendum-1.2-tvfs.md
    # -------------------------------------------------------------------------
    tvfs:
      - name: "get_{domain}_{metric}_summary"
        description: "Returns {metric} aggregated by {dimension} for a date range"
        parameters:
          - name: start_date
            type: STRING
            description: "Start date (YYYY-MM-DD format)"
          - name: end_date
            type: STRING
            description: "End date (YYYY-MM-DD format)"
        gold_tables_used:
          - fact_{entity}
          - dim_{entity_1}
        business_questions:
          - "Show {metric} summary for last 2 weeks"
          - "Daily {metric} breakdown for {date_range}"

      - name: "get_top_{domain}_contributors"
        description: "Returns top N contributors by {metric}"
        parameters:
          - name: start_date
            type: STRING
            description: "Start date (YYYY-MM-DD format)"
          - name: end_date
            type: STRING
            description: "End date (YYYY-MM-DD format)"
          - name: top_n
            type: STRING
            description: "Number of top results (default: 10)"
        gold_tables_used:
          - fact_{entity}
          - dim_{entity_1}
        business_questions:
          - "Which {dimension} are the top contributors?"
          - "Top 5 {dimension} by {metric} this month"

    # -------------------------------------------------------------------------
    # Genie Spaces for this domain
    # Source: phase1-addendum-1.6-genie-spaces.md
    # -------------------------------------------------------------------------
    genie_spaces:
      - name: "{Domain} Intelligence"
        description: "Natural language analytics for {domain} domain"
        warehouse: serverless
        assets:
          metric_views:
            - "{domain}_analytics_metrics"
          tvfs:
            - "get_{domain}_{metric}_summary"
            - "get_top_{domain}_contributors"
          tables:
            - "fact_{entity}"
            - "dim_{entity_1}"
            - "dim_{entity_2}"
        benchmark_questions_count: 10
        benchmark_questions:
          - question: "What is the total {metric}?"
            expected_asset: "{domain}_analytics_metrics"
          - question: "Show daily {metric} for last week"
            expected_asset: "get_{domain}_{metric}_summary"

# -----------------------------------------------------------------------------
# Summary counts (for validation)
# Fill in after populating all domains
# -----------------------------------------------------------------------------
summary:
  total_domains: "{N}"
  total_metric_views: "{N}"
  total_tvfs: "{N}"
  total_genie_spaces: "{N}"
  total_benchmark_questions: "{N}"

# =============================================================================
# GenAI Agents Manifest
# =============================================================================
# Generated by: planning/00-project-planning (stage 5)
# Consumed by:  genai-agents/00-genai-agents-setup (stage 9)
#
# This manifest defines all AI agents, their Genie Space mappings, tools,
# evaluation datasets, and deployment configuration. It is generated from the
# plan document (phase2-agent-framework.md) and the semantic-layer-manifest.yaml
# (since agents consume Genie Spaces created in stage 6).
#
# Usage:
#   1. Fill in the template below during Planning (stage 5)
#   2. Save as: plans/manifests/genai-agents-manifest.yaml
#   3. The genai-agents orchestrator reads this at Phase 0
#   4. If this file doesn't exist, the orchestrator falls back to self-discovery
# =============================================================================

version: 1
manifest_type: genai-agents
generated_from:
  semantic_layer_manifest: plans/manifests/semantic-layer-manifest.yaml
  plan_documents:
    - plans/phase2-agent-framework.md

# -----------------------------------------------------------------------------
# Global settings
# -----------------------------------------------------------------------------
catalog: ${catalog}
gold_schema: ${gold_schema}
agent_schema: ${agent_schema}   # Schema for agent config tables, eval datasets

# -----------------------------------------------------------------------------
# Agent Architecture
# Defines the overall agent topology
# -----------------------------------------------------------------------------
architecture:
  pattern: "orchestrator-plus-workers"   # or "single-agent", "hierarchical"
  orchestrator:
    name: "{Project} Orchestrator Agent"
    description: "Routes user queries to domain-specific agents via intent classification"
    genie_space: "Unified {Project} Monitor"   # For intent classification
    model_endpoint: "{foundation_model_endpoint}"
    memory:
      short_term: true    # Lakebase CheckpointSaver
      long_term: true     # Lakebase DatabricksStore

# -----------------------------------------------------------------------------
# Domain Agents
# One per agent domain, each maps to a Genie Space
# -----------------------------------------------------------------------------
agents:
  - name: "{Domain} Agent"
    domain: "{domain}"
    description: "Specialized agent for {domain} analytics and insights"
    genie_space: "{Domain} Intelligence"          # From semantic-layer-manifest
    genie_space_id: "{to_be_filled_after_deployment}"
    use_case_refs:              # Links back to plans/use-case-catalog.md
      - "UC-001"                # {Use case name}
    capabilities:
      - "Answer {domain} business questions via Genie"
      - "Provide {metric} analysis and trends"
      - "Alert on {domain} anomalies"
    tools:
      - name: "query_{domain}_genie"
        type: "genie_conversation_api"
        description: "Query {Domain} Intelligence Genie Space"
      - name: "get_{domain}_alerts"
        type: "sql_query"
        description: "Retrieve active {domain} alerts"
    sample_questions:
      - "What is the current {metric}?"
      - "Show me {metric} trends for last month"
      - "Which {entities} need attention?"

# -----------------------------------------------------------------------------
# Evaluation Configuration
# Defines evaluation datasets and scoring criteria
# -----------------------------------------------------------------------------
evaluation:
  dataset_table: "${catalog}.${agent_schema}.agent_eval_dataset"
  questions_per_domain: 10
  domains:
    - domain: "{domain}"
      questions:
        - input: "What is the total {metric}?"
          expected_response_contains: ["{metric_keyword}", "total"]
          expected_data_source: "genie"
        - input: "Show me {metric} trends"
          expected_response_contains: ["trend", "{metric_keyword}"]
          expected_data_source: "genie"
  
  scorers:
    builtin:
      - "relevance"
      - "safety"
      - "guideline_adherence"
    custom:
      - name: "data_grounding"
        description: "Checks if response is grounded in actual data (not hallucinated)"
        guidelines_count: 4
      - name: "domain_routing"
        description: "Checks if intent classification routes to correct domain"
        guidelines_count: 4
  
  thresholds:
    relevance: 0.8
    safety: 0.9
    guideline_adherence: 0.7
    data_grounding: 0.8
    domain_routing: 0.9

# -----------------------------------------------------------------------------
# Prompt Management
# Defines prompts to store in Unity Catalog / MLflow Registry
# -----------------------------------------------------------------------------
prompts:
  - name: "{project}_orchestrator_system_prompt"
    description: "System prompt for the orchestrator agent"
    initial_version: "You are a {project} analytics assistant..."
  - name: "{project}_{domain}_agent_prompt"
    description: "System prompt for the {domain} agent"
    initial_version: "You are a {domain} specialist..."

# -----------------------------------------------------------------------------
# Deployment Configuration
# -----------------------------------------------------------------------------
deployment:
  model_name: "${catalog}.${agent_schema}.{project}_agent"
  serving_endpoint: "{project}-agent-endpoint"
  auto_deploy_on_eval_pass: true
  experiments:
    dev: "/Shared/{project}_agent_dev"
    eval: "/Shared/{project}_agent_eval"
    deploy: "/Shared/{project}_agent_deploy"

# -----------------------------------------------------------------------------
# Summary counts (for validation)
# Fill in after populating all domains
# -----------------------------------------------------------------------------
summary:
  total_agents: "{N}"       # Including orchestrator
  total_genie_mappings: "{N}"
  total_eval_questions: "{N}"
  total_custom_scorers: "{N}"
  total_prompts: "{N}"
